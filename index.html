<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calcolatore p53 v1.0</title>
<style>
  :root { --pad: 16px; --radius: 12px; --maxw: 1200px; --primary: #1e40af; --success: #059669; --warning: #d97706; --danger: #dc2626; --info: #0891b2; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:#f8fafc; color:#1e293b; line-height: 1.5; }
  .wrap { max-width: var(--maxw); margin: 20px auto 60px; padding: 0 var(--pad); }
  .card { background:#fff; border-radius: var(--radius); padding: var(--pad); box-shadow: 0 4px 16px rgba(0,0,0,0.08); margin-bottom: 20px; border: 1px solid #e2e8f0; }
  .card-header { border-bottom: 1px solid #e2e8f0; margin-bottom: var(--pad); padding-bottom: 12px; }
  h1 { font-size: 1.5rem; margin: 0; color: var(--primary); font-weight: 700; }
  h2 { font-size: 1.1rem; margin: 0 0 12px; color: #374151; font-weight: 600; }
  h3 { font-size: 1rem; margin: 16px 0 8px; color: #4b5563; font-weight: 600; }
  
  .form-group { margin-bottom: 16px; }
  label { display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 6px; color: #374151; }
  input[type="number"], input[type="text"], select, textarea { width: 100%; padding: 10px 12px; border: 1.5px solid #d1d5db; border-radius: 8px; font-size: 0.95rem; transition: border-color 0.2s; box-sizing: border-box; }
  input[type="number"]:focus, input[type="text"]:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(30,64,175,0.1); }
  input[type="checkbox"], input[type="radio"] { width: auto; margin-right: 8px; }
  
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  
  .hint { font-size: 0.82rem; color: #6b7280; margin-top: 4px; }
  .hint.important { color: var(--warning); font-weight: 500; }
  
  .btn { display: inline-block; padding: 12px 20px; border-radius: 8px; border: 0; background: var(--primary); color: #fff; font-weight: 600; cursor: pointer; font-size: 0.95rem; transition: all 0.2s; margin-right: 8px; margin-bottom: 8px; }
  .btn:hover { background: #1e3a8a; transform: translateY(-1px); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .btn-secondary { background: #6b7280; }
  .btn-secondary:hover { background: #4b5563; }
  .btn-small { padding: 8px 14px; font-size: 0.85rem; }
  .btn-success { background: var(--success); }
  .btn-success:hover { background: #047857; }
  
  .mode-toggle { display: flex; gap: 8px; margin: 12px 0; }
  .mode-btn { padding: 10px 16px; border: 2px solid #d1d5db; background: #fff; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
  .mode-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
  .mode-btn:hover { border-color: var(--primary); }
  
  .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
  .badge-wt { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
  .badge-oe { background: #fed7aa; color: #9a3412; border: 1px solid #fdba74; }
  .badge-null { background: #fecaca; color: #991b1b; border: 1px solid #fca5a5; }
  .badge-nodys { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
  .badge-lgd { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
  .badge-hgd { background: #fed7aa; color: #9a3412; border: 1px solid #fdba74; }
  .badge-cancer { background: #fecaca; color: #991b1b; border: 1px solid #fca5a5; }
  .badge-ni { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
  
  .alert { padding: 12px 16px; border-radius: 8px; margin: 12px 0; border-left: 4px solid; }
  .alert-success { background: #f0fdf4; border-color: var(--success); color: #15803d; }
  .alert-warning { background: #fffbeb; border-color: var(--warning); color: #a16207; }
  .alert-danger { background: #fef2f2; border-color: var(--danger); color: #b91c1c; }
  .alert-info { background: #f0f9ff; border-color: var(--info); color: #0c4a6e; }
  
  .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin: 16px 0; }
  .metric { background: #f8fafc; padding: 12px; border-radius: 8px; text-align: center; border: 1px solid #e2e8f0; }
  .metric-value { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
  .metric-label { font-size: 0.85rem; color: #6b7280; margin-top: 4px; }
  
  .output-section { display: none; }
  .output-section.show { display: block; }
  
  .form-section { display: none; }
  .form-section.active { display: block; }
  
  .checklist label { display: flex; align-items: center; margin: 8px 0; font-weight: 400; }
  
  .report-output { background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 8px; padding: 16px; font-family: 'Courier New', monospace; font-size: 0.85rem; white-space: pre-wrap; margin: 12px 0; max-height: 350px; overflow-y: auto; }
  
  .copy-btn { background: var(--success); }
  .copy-btn:hover { background: #047857; }
  
  .tiny { font-size: 0.8rem; color: #6b7280; }
  .strong { font-weight: 600; }
  
  @media (max-width: 768px) {
    .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    .wrap { padding: 0 12px; }
    .mode-toggle { flex-direction: column; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <div class="card">
      <div class="card-header">
        <h1>Calcolatore p53 v1.0</h1>
        <p class="tiny">p53 IHC (Neoplastico) + Displasia Gastrica & Colonica (Preneoplastico) ‚Ä¢ WHO 2022 ‚Ä¢ <strong>Research & diagnostic support only</strong></p>
      </div>
      <div class="alert alert-info">
        <strong>Uso diagnostico supportivo.</strong> Valutazione finale richiede correlazione clinico-patologica completa. <strong>p53 IHC:</strong> Singh 2020, K√∂bel 2016/2019. <strong>Displasia gastrica:</strong> WHO 2022, Rugge MAPS 2016. <strong>Displasia colonica:</strong> WHO/SCENIC 2019. <strong>v1.0: Unified tool p53 IHC + displasia gastrica + displasia colonica con organ-specific parameters, shared infrastructure.</strong>
      </div>
    </div>

    <!-- Mode Selection -->
    <div class="card">
      <h2>Seleziona modalit√†</h2>
      <div class="mode-toggle">
        <button class="mode-btn active" onclick="setMode('p53')">üß¨ p53 IHC (Neoplastico)</button>
        <button class="mode-btn" onclick="setMode('gastric')">üî¨ Displasia Gastrica (Preneoplastico)</button>
        <button class="mode-btn" onclick="setMode('colonic')">üîç Displasia Colonica (Preneoplastico)</button>
      </div>
      <div class="hint">Cambia modalit√† per il flusso diagnostico adatto</div>
    </div>

    <!-- P53 SECTION -->
    <div id="p53-section" class="form-section active">
      <!-- P53 Quick Presets -->
      <div class="card">
        <h2>‚ö° Quick Entry</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0;">
          <button class="btn btn-small btn-secondary" onclick="loadPreset('p53_classic_oe')">Classic OE</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('p53_null')">Null</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('p53_mosaic_wt')">Mosaic WT</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('p53_cyto')">Cytoplasmic</button>
        </div>
      </div>

      <!-- P53 Input Form -->
      <div class="card">
        <h2>p53 IHC - Parametri di valutazione</h2>
        
        <div class="grid-2">
          <div class="form-group">
            <label>Tipo di tumore/organo</label>
            <select id="p53-tumorType">
              <option value="endometrio">Carcinoma endometriale</option>
              <option value="ovaio">Carcinoma ovarico (HG sieroso)</option>
              <option value="colon">Carcinoma colon-rettale</option>
              <option value="mammella">Carcinoma mammario</option>
              <option value="polmone">Carcinoma polmonare</option>
              <option value="stomaco">Carcinoma gastrico</option>
              <option value="pancreas">Carcinoma pancreatico</option>
              <option value="vescica">Carcinoma uroteliale</option>
              <option value="sarcoma">Sarcoma</option>
              <option value="altro">Altro</option>
            </select>
            <div class="hint">‚ö†Ô∏è Soglie organo-specifiche validate per endometrio e ovaio</div>
          </div>
          
          <div class="form-group">
            <label>Tipo di campione</label>
            <select id="p53-specimenType">
              <option value="biopsia">Biopsia</option>
              <option value="resezione">Resezione chirurgica</option>
              <option value="citologia">Campione citologico</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>ID caso (opzionale)</label>
          <input type="text" id="p53-caseId" placeholder="Es: EN24-12345" />
        </div>

        <h3>Contesto molecolare</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>MMR status</label>
            <select id="p53-mmrStatus">
              <option value="unknown">Non noto</option>
              <option value="proficient">Proficient</option>
              <option value="deficient">Deficient</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>POLE status</label>
            <select id="p53-poleStatus">
              <option value="unknown">Non noto</option>
              <option value="wildtype">Wild-type</option>
              <option value="mutated">Mutato</option>
            </select>
            <div class="hint">‚ö†Ô∏è POLE-mut + p53-OE raro (~5%)</div>
          </div>

          <div class="form-group">
            <label>Grado istologico</label>
            <select id="p53-grade">
              <option value="unknown">Non specificato</option>
              <option value="low">Low-grade</option>
              <option value="high">High-grade</option>
            </select>
          </div>
        </div>

        <h3>Controlli tecnici</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>Controllo interno</label>
            <select id="p53-internalControl">
              <option value="none">Assente</option>
              <option value="present">Presente</option>
              <option value="endothelium">Endotelio vascolare</option>
              <option value="stromal">Cellule stromali</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Intensit√† controllo</label>
            <select id="p53-controlIntensity">
              <option value="none">N/A</option>
              <option value="weak">Debole</option>
              <option value="moderate">Moderata</option>
              <option value="strong">Forte</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Qualit√† tecnica</label>
            <select id="p53-technicalQuality">
              <option value="optimal">Ottimale</option>
              <option value="acceptable">Accettabile</option>
              <option value="suboptimal">Subottimale</option>
              <option value="poor">Inaccettabile</option>
            </select>
          </div>
        </div>

        <h3>Quantificazione (% nuclei tumorali)</h3>
        <div class="grid-4">
          <div class="form-group">
            <label>Negativi (0)</label>
            <input type="number" id="p53-perc0" min="0" max="100" step="5" value="0" />
          </div>
          <div class="form-group">
            <label>Deboli (1+)</label>
            <input type="number" id="p53-perc1" min="0" max="100" step="5" value="0" />
          </div>
          <div class="form-group">
            <label>Moderati (2+)</label>
            <input type="number" id="p53-perc2" min="0" max="100" step="5" value="0" />
          </div>
          <div class="form-group">
            <label>Forti (3+)</label>
            <input type="number" id="p53-perc3" min="0" max="100" step="5" value="0" />
          </div>
        </div>

        <h3>Pattern</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>Distribuzione</label>
            <select id="p53-distribution">
              <option value="mosaic">Eterogenea/mosaico</option>
              <option value="diffuse">Diffusa/uniforme</option>
              <option value="focal">Focale</option>
              <option value="zonal">Zonale</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Localizzazione subcellulare</label>
            <select id="p53-localization">
              <option value="nuclear">Nucleare</option>
              <option value="cytoplasmic">Citoplasmatica</option>
              <option value="both">Nucleo-citoplasmatica</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Pattern aberrante specifico</label>
          <select id="p53-specialPattern">
            <option value="none">Nessuno</option>
            <option value="rim">Rim-like periferico</option>
            <option value="speckled">Speckled punteggiato</option>
            <option value="excluded">Esclusione nucleare</option>
          </select>
        </div>

        <div class="form-group">
          <label>Note libere</label>
          <textarea id="p53-additionalNotes" rows="2" placeholder="Artefatti, eterogeneit√† regionale..."></textarea>
        </div>

        <button class="btn" onclick="analyzeP53()">üî¨ Analizza p53 (Ctrl+Enter)</button>
        <button class="btn btn-secondary" onclick="resetForm('p53')">Reset</button>
      </div>
    </div>

    <!-- GASTRIC SECTION -->
    <div id="gastric-section" class="form-section">
      <!-- Gastric Quick Presets -->
      <div class="card">
        <h2>‚ö° Quick Entry</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0;">
          <button class="btn btn-small btn-secondary" onclick="loadPreset('gastric_nodys')">No Dysplasia</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('gastric_lgd')">LGD</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('gastric_hgd')">HGD</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('gastric_cancer')">Carcinoma</button>
        </div>
      </div>

      <!-- Gastric Input Form -->
      <div class="card">
        <h2>Displasia Gastrica - Parametri di valutazione</h2>
        
        <div class="grid-2">
          <div class="form-group">
            <label>Localizzazione</label>
            <select id="gastric-location">
              <option value="antrum">Antro</option>
              <option value="body">Corpo</option>
              <option value="fundus">Fondo</option>
              <option value="cardia">Cardia</option>
              <option value="multifocal">Multifocale</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Tipo campione</label>
            <select id="gastric-specimenType">
              <option value="biopsia">Biopsia endoscopica</option>
              <option value="resezione">Pezzo chirurgico</option>
              <option value="multifocal">Biopsie multifocali</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>ID caso (opzionale)</label>
          <input type="text" id="gastric-caseId" placeholder="Es: GAST24-5678" />
        </div>

        <h3>Contesto clinico</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>H. pylori status</label>
            <select id="gastric-hpyloriStatus">
              <option value="unknown">Non noto</option>
              <option value="positive">Positivo</option>
              <option value="negative">Negativo</option>
              <option value="eradicated">Eradicato</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Metaplasia intestinale</label>
            <select id="gastric-imStatus">
              <option value="none">Assente</option>
              <option value="present">Presente</option>
              <option value="incomplete">Incompleta</option>
              <option value="extensive">Estesa</option>
            </select>
          </div>

          <div class="form-group">
            <label>Atrofia gastrica</label>
            <select id="gastric-atrophiaStatus">
              <option value="none">Assente</option>
              <option value="mild">Lieve</option>
              <option value="moderate">Moderata</option>
              <option value="severe">Severa</option>
            </select>
          </div>
        </div>

        <h3>Morfologia nucleare</h3>
        <div class="checklist">
          <label><input type="checkbox" id="gastric-morphPleomorphism" /> Pleomorfismo marcato</label>
          <label><input type="checkbox" id="gastric-morphCrowding" /> Affollamento nucleare</label>
          <label><input type="checkbox" id="gastric-morphHyperchromasia" /> Ipercromatismo marcato</label>
          <label><input type="checkbox" id="gastric-morphIrregular" /> Contorni nucleari irregolari</label>
          <label><input type="checkbox" id="gastric-morphProminent" /> Nucleoli prominenti</label>
          <label><input type="checkbox" id="gastric-morphMitoses" /> Mitosi >5/10HPF</label>
        </div>

        <h3>Architettura ghiandolare</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>Pattern architetturale</label>
            <select id="gastric-architecture">
              <option value="intact">Integro</option>
              <option value="basaldisruption">Disrupzione basale (focale)</option>
              <option value="cribriform">Cribriformo</option>
              <option value="glandular">Infiltrante</option>
            </select>
            <div class="hint">‚ö†Ô∏è Disrupzione basale = HGD/carcinoma</div>
          </div>
          
          <div class="form-group">
            <label>Stratificazione</label>
            <select id="gastric-stratification">
              <option value="normal">Normale</option>
              <option value="partial">Parziale</option>
              <option value="complete">Completa</option>
            </select>
          </div>
        </div>

        <h3>Immunofenotipo</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>p53 pattern (se disponibile)</label>
            <select id="gastric-p53Pattern">
              <option value="unknown">Non eseguito</option>
              <option value="wildtype">Wild-type</option>
              <option value="overexpression">Over-expression</option>
              <option value="null">Null</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Ki67 livello</label>
            <select id="gastric-ki67Level">
              <option value="unknown">Non quantificato</option>
              <option value="low">Basso (<10%)</option>
              <option value="moderate">Moderato (10-30%)</option>
              <option value="high">Alto (>30%)</option>
            </select>
          </div>
        </div>

        <h3>Estensione e profondit√†</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>Numero foci</label>
            <select id="gastric-extensionNumber">
              <option value="single">Singolo</option>
              <option value="few">Pochi (2-5)</option>
              <option value="multiple">Multipli (>5)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Profondit√† invasiva</label>
            <select id="gastric-invasionDepth">
              <option value="superficial">Superficiale</option>
              <option value="mid">Mucosa media</option>
              <option value="basal">Basale</option>
              <option value="submucosa">Sottomucosa</option>
            </select>
          </div>

          <div class="form-group">
            <label>Reazione stromale</label>
            <select id="gastric-stromalReaction">
              <option value="none">Assente</option>
              <option value="desmoplasia">Moderata</option>
              <option value="marked">Marcata</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Note cliniche</label>
          <textarea id="gastric-additionalNotes" rows="2" placeholder="Correlazione endoscopica, lesione visibile..."></textarea>
        </div>

        <button class="btn" onclick="analyzeGastric()">üî¨ Analizza displasia (Ctrl+Enter)</button>
        <button class="btn btn-secondary" onclick="resetForm('gastric')">Reset</button>
      </div>
    </div>

    <!-- COLONIC SECTION -->
    <div id="colonic-section" class="form-section">
      <!-- Colonic Quick Presets -->
      <div class="card">
        <h2>‚ö° Quick Entry</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0;">
          <button class="btn btn-small btn-secondary" onclick="loadPreset('colonic_nodys')">Negative</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('colonic_ind')">Indefinite</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('colonic_lgd')">LGD</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('colonic_hgd')">HGD</button>
          <button class="btn btn-small btn-secondary" onclick="loadPreset('colonic_cancer')">Carcinoma</button>
        </div>
      </div>

      <!-- Colonic Input Form -->
      <div class="card">
        <h2>Displasia Colonica - Parametri di valutazione</h2>
        
        <div class="grid-2">
          <div class="form-group">
            <label>Localizzazione segmento</label>
            <select id="colonic-location">
              <option value="cecum">Cieco</option>
              <option value="asc">Colon ascendente</option>
              <option value="transverse">Colon trasverso</option>
              <option value="desc">Colon discendente</option>
              <option value="sigmoid">Sigma</option>
              <option value="rectum">Retto</option>
              <option value="multifocal">Multifocale</option>
            </select>
            <div class="hint">IBD-associated: distribuzione segmentaria rilevante</div>
          </div>
          
          <div class="form-group">
            <label>Tipo campione</label>
            <select id="colonic-specimenType">
              <option value="biopsia">Biopsia endoscopica</option>
              <option value="polipectomy">Polipectomia</option>
              <option value="resezione">Pezzo chirurgico</option>
              <option value="multifocal">Biopsie multifocali</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>ID caso (opzionale)</label>
          <input type="text" id="colonic-caseId" placeholder="Es: COLON24-9012" />
        </div>

        <h3>Contesto clinico</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>IBD status</label>
            <select id="colonic-ibdStatus">
              <option value="no">No IBD</option>
              <option value="uc">Rettocolite ulcerosa</option>
              <option value="crohn">Morbo di Crohn</option>
              <option value="ibd-unspecified">IBD non classificato</option>
            </select>
            <div class="hint">IBD = rischio aumentato per displasia</div>
          </div>
          
          <div class="form-group">
            <label>Durata IBD (se presente)</label>
            <select id="colonic-ibdDuration">
              <option value="no">N/A</option>
              <option value="lt5">< 5 anni</option>
              <option value="5to10">5-10 anni</option>
              <option value="gt10">> 10 anni</option>
            </select>
          </div>

          <div class="form-group">
            <label>Attivit√† infiammatoria (IBD)</label>
            <select id="colonic-inflammationActivity">
              <option value="no">No IBD / N/A</option>
              <option value="quiescent">Quiescente</option>
              <option value="mild">Lieve</option>
              <option value="moderate">Moderata</option>
              <option value="severe">Severa</option>
            </select>
          </div>
        </div>

        <h3>Morfologia nucleare</h3>
        <div class="checklist">
          <label><input type="checkbox" id="colonic-morphPleomorphism" /> Pleomorfismo nucleare</label>
          <label><input type="checkbox" id="colonic-morphCrowding" /> Affollamento (N/C ratio ‚Üë)</label>
          <label><input type="checkbox" id="colonic-morphHyperchromasia" /> Ipercromatismo marcato</label>
          <label><input type="checkbox" id="colonic-morphIrregular" /> Contorni nucleari irregolari</label>
          <label><input type="checkbox" id="colonic-morphProminent" /> Nucleoli prominenti</label>
          <label><input type="checkbox" id="colonic-morphMitoses" /> Mitosi atipiche/aumentate</label>
        </div>

        <h3>Architettura ghiandolare</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>Pattern architetturale</label>
            <select id="colonic-architecture">
              <option value="normal">Normale (cripte ordinate)</option>
              <option value="distorted">Distorto (crowding cripte)</option>
              <option value="basaldisruption">Disrupzione basale focale</option>
              <option value="cribriform">Cribriformo/micropapille</option>
              <option value="glandular">Infiltrante ghiandolare</option>
            </select>
            <div class="hint">‚ö†Ô∏è Disrupzione basale/cribriformo = HGD/carcinoma</div>
          </div>
          
          <div class="form-group">
            <label>Stratificazione citoplasmatica</label>
            <select id="colonic-stratification">
              <option value="normal">Normale (polarit√† preservata)</option>
              <option value="partial">Parziale (focale perdita)</option>
              <option value="complete">Completa (disorganizzazione)</option>
            </select>
          </div>
        </div>

        <h3>Infiammazione e contesto</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>Infiltrato infiammatorio associato</label>
            <select id="colonic-inflammation">
              <option value="none">Assente</option>
              <option value="mild">Lieve</option>
              <option value="moderate">Moderato</option>
              <option value="marked">Marcato (IBD attiva)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Polipoid/sessile growth</label>
            <select id="colonic-polipoidGrowth">
              <option value="flat">Flat (non polipide)</option>
              <option value="sessile">Sessile</option>
              <option value="pedunculated">Peduncolato</option>
              <option value="polipoid">Polipide irregular</option>
            </select>
            <div class="hint">Morfologia endoscopica rilevante per grading</div>
          </div>
        </div>

        <h3>Immunofenotipo (se disponibile)</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>p53 pattern</label>
            <select id="colonic-p53Pattern">
              <option value="unknown">Non eseguito</option>
              <option value="wildtype">Wild-type (mosaico)</option>
              <option value="overexpression">Over-expression (>80%)</option>
              <option value="null">Null</option>
            </select>
            <div class="hint">p53-OE/null in colite frequente (30-50% HGD)</div>
          </div>
          
          <div class="form-group">
            <label>Ki67 proliferazione</label>
            <select id="colonic-ki67Level">
              <option value="unknown">Non quantificato</option>
              <option value="normal">Normale (basale)</option>
              <option value="increased">Aumentata (estesa nei 2/3)</option>
              <option value="high">Alta (diffusa, >50%)</option>
            </select>
          </div>
        </div>

        <h3>Estensione della lesione</h3>
        <div class="grid-3">
          <div class="form-group">
            <label>Numero foci displastici</label>
            <select id="colonic-extensionNumber">
              <option value="single">Singolo focus</option>
              <option value="few">Pochi (2-5 cripte)</option>
              <option value="multiple">Multipli (>5 cripte)</option>
              <option value="extensive">Estesa (>50% della mucosa)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Profondit√† massima</label>
            <select id="colonic-invasionDepth">
              <option value="superficial">Superficiale (solo mucosa superiore)</option>
              <option value="mid">Mucosa media</option>
              <option value="basal">Basale (vicinanza muscolo)</option>
              <option value="muscularis">Muscolo mucoso (microinvasione)</option>
              <option value="submucosa">Sottomucosa (invasione confermata)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Reazione desmoplastica</label>
            <select id="colonic-desmoplasia">
              <option value="none">Assente (non invasivo)</option>
              <option value="mild">Lieve</option>
              <option value="moderate">Moderata</option>
              <option value="marked">Marcata (invasione probabile)</option>
            </select>
          </div>
        </div>

        <h3>Qualit√† e contesto endoscopico</h3>
        <div class="grid-2">
          <div class="form-group">
            <label>Qualit√† orientamento tissutale</label>
            <select id="colonic-orientation">
              <option value="optimal">Ottimale</option>
              <option value="acceptable">Accettabile</option>
              <option value="suboptimal">Subottimale (tangenzialit√†)</option>
              <option value="poor">Scarsa</option>
            </select>
          </div>

          <div class="form-group">
            <label>Margini polipectomia (se applicabile)</label>
            <select id="colonic-margins">
              <option value="na">N/A (non polipectomia)</option>
              <option value="clear">Negativi (>2mm)</option>
              <option value="close">Compromessi (<2mm)</option>
              <option value="positive">Positivi (invasione al margine)</option>
            </select>
            <div class="hint">‚ö†Ô∏è Margini positivi = rischio residua/ricorrenza</div>
          </div>
        </div>

        <div class="form-group">
          <label>Note cliniche</label>
          <textarea id="colonic-additionalNotes" rows="2" placeholder="Aspetto endoscopico, ulcerazione, lesione visibile, surveillance pregressa..."></textarea>
        </div>

        <button class="btn" onclick="analyzeColonic()">üî¨ Analizza displasia (Ctrl+Enter)</button>
        <button class="btn btn-secondary" onclick="resetForm('colonic')">Reset</button>
      </div>
    </div>

    <!-- Output Section (shared) -->
    <div class="card output-section" id="outputSection">
      <h2>Risultato interpretativo</h2>
      
      <div class="metrics" id="metricsSection"></div>
      
      <div id="mainResult" class="alert"></div>
      
      <div id="detailedAnalysis"></div>
      
      <div id="recommendations"></div>

      <div id="reportSection" style="display:none;">
        <h3>Testo per referto</h3>
        <div class="report-output" id="reportText"></div>
        <button class="btn copy-btn" id="copyReportBtn">üìã Copia testo</button>
      </div>
    </div>
  </div>

<script>
// ============ GLOBALS ============
let currentMode = 'p53';

const P53_THRESHOLDS = {
  endometrio: { strong: 75, hscore: 200 },
  ovaio: { strong: 80, hscore: 180 },
  colon: { strong: 80, hscore: 220 },
  mammella: { strong: 80, hscore: 200 },
  polmone: { strong: 80, hscore: 200 },
  stomaco: { strong: 80, hscore: 210 },
  pancreas: { strong: 85, hscore: 220 },
  vescica: { strong: 80, hscore: 200 },
  sarcoma: { strong: 85, hscore: 220 },
  altro: { strong: 80, hscore: 200 }
};

const PRESETS = {
  p53_classic_oe: { 'p53-perc0': 5, 'p53-perc1': 5, 'p53-perc2': 20, 'p53-perc3': 70, 'p53-distribution': 'diffuse', 'p53-localization': 'nuclear' },
  p53_null: { 'p53-perc0': 100, 'p53-perc1': 0, 'p53-perc2': 0, 'p53-perc3': 0, 'p53-distribution': 'diffuse', 'p53-controlIntensity': 'strong' },
  p53_mosaic_wt: { 'p53-perc0': 40, 'p53-perc1': 30, 'p53-perc2': 25, 'p53-perc3': 5, 'p53-distribution': 'mosaic' },
  p53_cyto: { 'p53-perc0': 30, 'p53-perc1': 50, 'p53-perc2': 15, 'p53-perc3': 5, 'p53-localization': 'cytoplasmic' },
  gastric_nodys: { 'gastric-morphPleomorphism': false, 'gastric-morphCrowding': false, 'gastric-architecture': 'intact', 'gastric-stratification': 'normal', 'gastric-ki67Level': 'low' },
  gastric_lgd: { 'gastric-morphCrowding': true, 'gastric-morphHyperchromasia': false, 'gastric-architecture': 'intact', 'gastric-stratification': 'partial', 'gastric-ki67Level': 'moderate' },
  gastric_hgd: { 'gastric-morphPleomorphism': true, 'gastric-morphCrowding': true, 'gastric-morphHyperchromasia': true, 'gastric-morphIrregular': true, 'gastric-morphMitoses': true, 'gastric-architecture': 'cribriform', 'gastric-stratification': 'complete', 'gastric-ki67Level': 'high' },
  gastric_cancer: { 'gastric-morphPleomorphism': true, 'gastric-morphCrowding': true, 'gastric-morphHyperchromasia': true, 'gastric-morphMitoses': true, 'gastric-architecture': 'glandular', 'gastric-invasionDepth': 'submucosa', 'gastric-ki67Level': 'high' },
  colonic_nodys: { 'colonic-morphPleomorphism': false, 'colonic-morphCrowding': false, 'colonic-architecture': 'normal', 'colonic-stratification': 'normal', 'colonic-ki67Level': 'normal', 'colonic-p53Pattern': 'wildtype' },
  colonic_ind: { 'colonic-morphCrowding': true, 'colonic-morphHyperchromasia': false, 'colonic-architecture': 'distorted', 'colonic-stratification': 'partial', 'colonic-ki67Level': 'increased', 'colonic-inflammation': 'moderate' },
  colonic_lgd: { 'colonic-morphCrowding': true, 'colonic-morphHyperchromasia': false, 'colonic-morphMitoses': false, 'colonic-architecture': 'distorted', 'colonic-stratification': 'partial', 'colonic-ki67Level': 'increased', 'colonic-p53Pattern': 'wildtype' },
  colonic_hgd: { 'colonic-morphPleomorphism': true, 'colonic-morphCrowding': true, 'colonic-morphHyperchromasia': true, 'colonic-morphIrregular': true, 'colonic-morphMitoses': true, 'colonic-architecture': 'cribriform', 'colonic-stratification': 'complete', 'colonic-ki67Level': 'high', 'colonic-p53Pattern': 'overexpression', 'colonic-desmoplasia': 'moderate' },
  colonic_cancer: { 'colonic-morphPleomorphism': true, 'colonic-morphCrowding': true, 'colonic-morphHyperchromasia': true, 'colonic-morphMitoses': true, 'colonic-architecture': 'glandular', 'colonic-invasionDepth': 'submucosa', 'colonic-desmoplasia': 'marked', 'colonic-ki67Level': 'high' }
};

// ============ MODE CONTROL ============
function setMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('p53-section').classList.remove('active');
  document.getElementById('gastric-section').classList.remove('active');
  document.getElementById(mode + '-section').classList.add('active');
  document.getElementById('outputSection').classList.remove('show');
}

function loadPreset(presetName) {
  const preset = PRESETS[presetName];
  if (!preset) return;
  for (const [key, value] of Object.entries(preset)) {
    const elem = document.getElementById(key);
    if (elem) {
      if (elem.type === 'checkbox') elem.checked = value;
      else elem.value = value;
    }
  }
}

function resetForm(mode) {
  const prefix = mode === 'p53' ? 'p53-' : 'gastric-';
  document.querySelectorAll(`[id^="${prefix}"]`).forEach(elem => {
    if (elem.type === 'checkbox') elem.checked = false;
    else if (elem.type === 'text' || elem.tagName === 'TEXTAREA') elem.value = '';
    else if (elem.tagName === 'SELECT') elem.selectedIndex = 0;
  });
  document.getElementById('outputSection').classList.remove('show');
}

// ============ P53 ANALYSIS ============
function analyzeP53() {
  const data = {
    tumorType: document.getElementById('p53-tumorType').value,
    caseId: document.getElementById('p53-caseId').value,
    perc0: parseFloat(document.getElementById('p53-perc0').value) || 0,
    perc1: parseFloat(document.getElementById('p53-perc1').value) || 0,
    perc2: parseFloat(document.getElementById('p53-perc2').value) || 0,
    perc3: parseFloat(document.getElementById('p53-perc3').value) || 0,
    distribution: document.getElementById('p53-distribution').value,
    localization: document.getElementById('p53-localization').value,
    specialPattern: document.getElementById('p53-specialPattern').value,
    p53Pattern: document.getElementById('p53-poleStatus').value,
    mmrStatus: document.getElementById('p53-mmrStatus').value,
    poleStatus: document.getElementById('p53-poleStatus').value,
    controlIntensity: document.getElementById('p53-controlIntensity').value,
    technicalQuality: document.getElementById('p53-technicalQuality').value,
    additionalNotes: document.getElementById('p53-additionalNotes').value
  };

  const thresholds = P53_THRESHOLDS[data.tumorType];
  const hScore = (data.perc1 * 1) + (data.perc2 * 2) + (data.perc3 * 3);
  const percStrong = data.perc2 + data.perc3;
  const percAny = data.perc1 + data.perc2 + data.perc3;

  let grade, title, reason, action;

  if (data.technicalQuality === 'poor') {
    grade = 'ni'; title = 'Non interpretabile'; reason = 'Qualit√† tecnica inaccettabile'; action = 'RIPETERE COLORAZIONE';
  } else if (percAny === 0 && data.controlIntensity === 'strong') {
    grade = 'null'; title = 'Pattern null'; reason = 'Assenza nuclei positivi + controllo forte'; action = 'Pattern aberrante confermato';
  } else if (data.localization === 'cytoplasmic' && percAny <= 20) {
    grade = 'cyto'; title = 'Pattern citoplasmatico aberrante'; reason = 'Sequestro citoplasmatico con nuclei negativi'; action = 'Pattern aberrante';
  } else if (percStrong >= thresholds.strong || hScore >= thresholds.hscore) {
    grade = 'oe'; title = 'Pattern over-expression'; reason = `${percStrong.toFixed(0)}% forte / H-score ${hScore.toFixed(0)}`; action = 'Pattern aberrante';
  } else {
    grade = 'wt'; title = 'Wild-type'; reason = 'Nessun criterio over-expression'; action = 'Nessun testing molecolare necessario';
  }

  updateOutput(grade, title, reason, action, { perc0: data.perc0, perc1: data.perc1, perc2: data.perc2, perc3: data.perc3, hScore: hScore, caseId: data.caseId });
  generateP53Report(grade, title, reason, data, hScore);
}

// ============ GASTRIC ANALYSIS ============
function analyzeGastric() {
  const data = {
    caseId: document.getElementById('gastric-caseId').value,
    location: document.getElementById('gastric-location').value,
    morphPleomorphism: document.getElementById('gastric-morphPleomorphism').checked,
    morphCrowding: document.getElementById('gastric-morphCrowding').checked,
    morphHyperchromasia: document.getElementById('gastric-morphHyperchromasia').checked,
    morphIrregular: document.getElementById('gastric-morphIrregular').checked,
    morphMitoses: document.getElementById('gastric-morphMitoses').checked,
    architecture: document.getElementById('gastric-architecture').value,
    stratification: document.getElementById('gastric-stratification').value,
    invasionDepth: document.getElementById('gastric-invasionDepth').value,
    stromalReaction: document.getElementById('gastric-stromalReaction').value,
    additionalNotes: document.getElementById('gastric-additionalNotes').value
  };

  const morphCount = [data.morphPleomorphism, data.morphCrowding, data.morphHyperchromasia, data.morphIrregular, data.morphMitoses].filter(c => c).length;
  const hasBasalDisruption = ['basaldisruption', 'cribriform', 'glandular'].includes(data.architecture);

  let grade, title, reason, action;

  if (data.invasionDepth === 'submucosa') {
    grade = 'cancer'; title = 'CARCINOMA ADENOCARCINOMA GASTRICO'; reason = 'Invasione sottomucosa confermata'; action = 'URGENTE: staging, chirurgia, oncologia';
  } else if (morphCount >= 3 && hasBasalDisruption && data.architecture !== 'intact') {
    grade = 'hgd'; title = 'DISPLASIA AD ALTO GRADO (HGD)'; reason = 'Morfologia HGD + disrupzione basale'; action = 'ESD o chirurgia + follow-up endoscopico';
  } else if (data.morphCrowding && data.architecture === 'intact' && !hasBasalDisruption) {
    grade = 'lgd'; title = 'DISPLASIA A BASSO GRADO (LGD)'; reason = 'Atipia lieve + architettura integra'; action = 'Ripetere biopsia in 2-3 mesi, surveillance';
  } else {
    grade = 'nodys'; title = 'NON DISPLASIA'; reason = 'Architettura integra, morfologia benigna'; action = 'Surveillance secondo MAPS risk stratification';
  }

  updateOutput(grade, title, reason, action, { morphCount: morphCount, caseId: data.caseId, location: data.location });
  generateGastricReport(grade, title, reason, data, morphCount);
}

// ============ COLONIC ANALYSIS ============
function analyzeColonic() {
  const data = {
    caseId: document.getElementById('colonic-caseId').value,
    location: document.getElementById('colonic-location').value,
    ibdStatus: document.getElementById('colonic-ibdStatus').value,
    morphPleomorphism: document.getElementById('colonic-morphPleomorphism').checked,
    morphCrowding: document.getElementById('colonic-morphCrowding').checked,
    morphHyperchromasia: document.getElementById('colonic-morphHyperchromasia').checked,
    morphIrregular: document.getElementById('colonic-morphIrregular').checked,
    morphMitoses: document.getElementById('colonic-morphMitoses').checked,
    architecture: document.getElementById('colonic-architecture').value,
    stratification: document.getElementById('colonic-stratification').value,
    invasionDepth: document.getElementById('colonic-invasionDepth').value,
    desmoplasia: document.getElementById('colonic-desmoplasia').value,
    margins: document.getElementById('colonic-margins').value,
    additionalNotes: document.getElementById('colonic-additionalNotes').value
  };

  const morphCount = [data.morphPleomorphism, data.morphCrowding, data.morphHyperchromasia, data.morphIrregular, data.morphMitoses].filter(c => c).length;
  const hasArchDisruption = ['basaldisruption', 'cribriform', 'glandular'].includes(data.architecture);

  let grade, title, reason, action, risk;

  // Quality control
  if (document.getElementById('colonic-orientation').value === 'poor') {
    grade = 'ni'; title = 'Non interpretabile'; reason = 'Qualit√† tissutale insufficiente'; action = 'RIPETERE BIOPSIA'; risk = 'N/A';
  }
  // CARCINOMA
  else if (data.invasionDepth === 'submucosa' || (data.invasionDepth === 'muscularis' && data.desmoplasia === 'marked')) {
    grade = 'cancer'; title = 'CARCINOMA ADENOCARCINOMA COLON'; reason = 'Invasione sottomucosa o muscolaris confermata'; 
    action = 'URGENTE: staging TNM, oncologia, follow-up post-operatorio'; risk = 'Molto alto';
  }
  // HGD (strict criteria: morph ‚â•3 + arch disruption)
  else if (morphCount >= 3 && hasArchDisruption) {
    grade = 'hgd'; title = 'DISPLASIA AD ALTO GRADO (HGD)'; 
    reason = `Morfologia HGD (${morphCount}/5 criteri) + disrupzione basale/cribriformo`;
    if (data.ibdStatus !== 'no') {
      action = 'IBD-HGD: polipectomia/resezione se possibile; se non resecabile ‚Üí considerare colectomia. Surveillance stretta post-intervento.';
    } else {
      action = 'Sporadic HGD: polipectomia completa + margini negativi; resezione se margini positivi.';
    }
    risk = 'Alto (30-50% progressione annuale se non trattato)';
  }
  // IND (Indefinite for dysplasia) - morphologicamente intermedio
  else if (morphCount >= 2 && morphCount < 3 && (data.ibdStatus !== 'no' || data.architecture === 'distorted')) {
    grade = 'ind'; title = 'INDEFINITA PER DISPLASIA'; 
    reason = `Atipia borderline (${morphCount}/5 criteri) + architettura distorta, senza criteri HGD chiari`;
    if (data.ibdStatus !== 'no') {
      action = 'IBD: ripetere biopsia in 2-3 mesi; correlazione endoscopica; considera p53/Ki67 se dubbio persiste.';
    } else {
      action = 'Non-IBD: ripetere biopsia per conferma; se confermato ‚Üí resezione; follow-up.';
    }
    risk = 'Intermedio (1-5% progressione annuale, dipende IBD duration)';
  }
  // LGD (basso grado: crowding + architettura distorta ma NO disrupzione basale)
  else if ((data.morphCrowding || morphCount >= 1) && data.architecture !== 'normal' && !hasArchDisruption && data.stratification !== 'complete') {
    grade = 'lgd'; title = 'DISPLASIA A BASSO GRADO (LGD)'; 
    reason = `Atipia lieve (${morphCount}/5 criteri) + distorsione architetturale senza disrupzione basale`;
    if (data.ibdStatus !== 'no') {
      action = 'IBD-LGD: surveillance endoscopica ogni 6-12 mesi con biopsie random; conferma istologica consigliata. Considerare p53.';
    } else {
      action = 'Sporadic LGD: polipectomia se in polipo (margini), altrimenti sorveglianza ravvicinata.';
    }
    risk = 'Basso (1-2% progressione annuale)';
  }
  // NEGATIVE
  else {
    grade = 'nodys'; title = 'NEGATIVO PER DISPLASIA'; 
    reason = 'Architettura normale, citologia benigna';
    if (data.ibdStatus !== 'no') {
      action = 'IBD surveillance: endoscopia con biopsie random ogni 1-2 anni (dipende durata IBD e infiammazione attuale).';
    } else {
      action = 'Sporadic: surveillance colonscopia standard (10 anni se polipo <10mm, 3-5 anni se precedente).';
    }
    risk = 'Basso';
  }

  updateOutput(grade, title, reason, action, { morphCount: morphCount, caseId: data.caseId, location: data.location });
  generateColonicReport(grade, title, reason, data, morphCount, risk);
}

// ============ SHARED OUTPUT ============
function updateOutput(grade, title, reason, action, metrics) {
  let metricsHTML = '';
  if (metrics.caseId) metricsHTML += `<div class="metric"><div class="metric-value">${metrics.caseId}</div><div class="metric-label">ID caso</div></div>`;
  if (metrics.hScore !== undefined) metricsHTML += `<div class="metric"><div class="metric-value">${metrics.hScore.toFixed(0)}</div><div class="metric-label">H-score</div></div>`;
  if (metrics.morphCount !== undefined) metricsHTML += `<div class="metric"><div class="metric-value">${metrics.morphCount}/5</div><div class="metric-label">Criteri morfologici</div></div>`;
  
  document.getElementById('metricsSection').innerHTML = metricsHTML;

  const alertType = grade === 'ni' || grade === 'cancer' ? 'danger' : grade === 'oe' || grade === 'hgd' ? 'warning' : 'success';
  
  let mainHTML = `<span class="badge badge-${grade}">${title}</span><div style="margin-top: 12px;"><strong>Motivazione:</strong> ${reason}<br><strong>Azione:</strong> ${action}</div>`;
  
  document.getElementById('mainResult').innerHTML = mainHTML;
  document.getElementById('mainResult').className = `alert alert-${alertType}`;
  
  document.getElementById('detailedAnalysis').innerHTML = `<h3>Analisi dettagliata</h3><p>${reason}</p>`;
  document.getElementById('recommendations').innerHTML = `<h3>Raccomandazioni</h3><div class="alert alert-${alertType}">${action}</div>`;
  
  document.getElementById('outputSection').classList.add('show');
  document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function generateP53Report(grade, title, reason, data, hScore) {
  let report = `p53 INTERPRETAZIONE - PATTERN-BASED\n===================\n\n`;
  report += `Caso: ${data.caseId || 'N/A'}\nOrgano: ${data.tumorType}\nGrado: ${title}\n`;
  report += `Perc0: ${data.perc0}% | Perc1: ${data.perc1}% | Perc2: ${data.perc2}% | Perc3: ${data.perc3}%\n`;
  report += `H-score: ${hScore.toFixed(0)}\n\nMotivazione: ${reason}\n\nNOTE: ${data.additionalNotes || 'Nessuna'}`;
  
  document.getElementById('reportText').textContent = report;
  document.getElementById('reportSection').style.display = 'block';
}

function generateGastricReport(grade, title, reason, data, morphCount) {
  let report = `DISPLASIA GASTRICA - WHO 2022\n===================\n\n`;
  report += `Caso: ${data.caseId || 'N/A'}\nLocalizzazione: ${data.location}\nGrado: ${title}\n`;
  report += `Criteri morfologici: ${morphCount}/5\nArchitettura: ${data.architecture}\nStratificazione: ${data.stratification}\nProfondit√†: ${data.invasionDepth}\n`;
  report += `\nMotivazione: ${reason}\n\nNOTE: ${data.additionalNotes || 'Nessuna'}`;
  
  document.getElementById('reportText').textContent = report;
  document.getElementById('reportSection').style.display = 'block';
}

function generateColonicReport(grade, title, reason, data, morphCount, risk) {
  let report = `DISPLASIA COLONICA - WHO/SCENIC 2019\n===================\n\n`;
  report += `Caso: ${data.caseId || 'N/A'}\nLocalizzazione: ${data.location}\nIBD status: ${data.ibdStatus}\nGrado: ${title}\n`;
  report += `Criteri morfologici: ${morphCount}/5\nArchitettura: ${data.architecture}\nStratificazione: ${data.stratification}\nProfondit√†: ${data.invasionDepth}\n`;
  report += `Desmoplasia: ${data.desmoplasia}\nMargini: ${data.margins}\n`;
  report += `\nMotivazione: ${reason}\nRisk stratification: ${risk}\n\nNOTE: ${data.additionalNotes || 'Nessuna'}`;
  
  document.getElementById('reportText').textContent = report;
  document.getElementById('reportSection').style.display = 'block';
}

// ============ EVENT LISTENERS ============
document.getElementById('copyReportBtn')?.addEventListener('click', function() {
  const reportText = document.getElementById('reportText').textContent;
  navigator.clipboard.writeText(reportText).then(() => {
    const btn = document.getElementById('copyReportBtn');
    const originalText = btn.textContent;
    btn.textContent = '‚úì Copiato!';
    setTimeout(() => btn.textContent = originalText, 2000);
  });
});

document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 'Enter') {
    e.preventDefault();
    if (currentMode === 'p53') analyzeP53();
    else if (currentMode === 'gastric') analyzeGastric();
    else if (currentMode === 'colonic') analyzeColonic();
  }
});
</script>
</body>
</html>
